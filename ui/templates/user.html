{% extends "base.html" %}

{% block title %}sherwood | user{% endblock %}

{% block style %}
{% endblock %}

{% block content %}
<div id="user-id-data-container" data-user-id="{{ user_id }}"></div>

<h1>User Profile</h1>

<div>
  <table id="user-summary-table"></table>
</div>

{% include "portfolio.html" %}
{% endblock %}

{% block script %}
<script>
  function populateUserSummaryTable(user) {
    const userSummaryTable = document.getElementById("user-summary-table");
    const userSummaryTableBody = document.createElement('tbody');
    userSummaryTable.appendChild(userSummaryTableBody);
    let row;

    row = document.createElement('tr');
    row.insertCell(0).textContent = 'display name:';
    row.insertCell(1).textContent = `${user.display_name}`;
    userSummaryTableBody.appendChild(row);

    row = document.createElement('tr');
    row.insertCell(0).textContent = 'member since:';
    row.insertCell(1).textContent = `${user.created_at}`;
    userSummaryTableBody.appendChild(row);
  }

  sherwood.addEventListener(USER_EVENT_NAME, async ({ detail: user }) => {
    console.log(user);
    emitPortfolio({ portfolio_id: user.portfolio.id });
    populateUserSummaryTable(user);
  });

  window.onload = async () => {
    const userId = document.getElementById("user-id-data-container").getAttribute("data-user-id");
    emitAuthorizedUser();
    emitUser(userId);
  };
</script>
{% endblock %}